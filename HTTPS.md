#Network
#### HTTPS 出现的原因

HTTPS 出现是因为 HTTP 传输的内容是**明文传输**, 没有经过任何加密, 在传输的过程中的任意节点都可能被监听, 传输内容会被完全暴露, 有一种攻击方法就是**中间人攻击**(Man In The Middle), 还有运营商劫持, 严重影响用户体验.

#### HTTPS 实现原理

HTTPS 就是通过 **SSL/TLS 加密**数据包后的HTTP通信.

-   SSL - Secure Sockets Layer 安全套接层
-   TLS - Transport Layer Security 传输层安全协议

**传输-加密过程**

1.  用户在浏览器发起HTTPS请求(如 https://www.mogu.com/) 默认使用服务端的443端口进行连接；
2.  HTTPS需要使用一套**CA数字证书**，证书内会附带一个**公钥Pub**，而与之对应的**私钥Private**保留在服务端不公开；

3.  服务端收到请求，返回配置好的包含**公钥Pub**的证书给客户端；
4.  客户端收到证书，校验合法性，主要包括是否在有效期内、证书的域名与请求的域名是否匹配，上一级证书是否有效（递归判断，直到判断到系统内置或浏览器配置好的根证书），如果不通过，则显示HTTPS警告信息，如果通过则继续；

5.  客户端生成一个用于**对称加密**的随机Key，并用证书内的**公钥Pu****b**进行加密，发送给服务端；
6.  服务端收到随机Key的密文，使用与公钥Pub配对的**私钥Private**进行解密，得到客户端真正想发送的**随机Key**；

7.  服务端使用客户端发送过来的随机Key对要传输的HTTP数据进行**对称加密**，将密文返回客户端；
8.  客户端使用随机Key**对称解密**密文，得到HTTP数据明文；

9.  后续HTTPS请求使用之前交换好的随机Key进行**对称加解密**。

#### 对称加密和非对称加密

-   **对称加密**指的是有一个密钥, 用它可以对一段明文加密, 加密之后也只能用该密钥来解密获得明文, 如果通信双方都有密钥, 且不被第三方知晓, 那么通信间的安全性是可以得到保证的.
-   这个时候服务端发送的客户端对象事先是不知道, 需要事先传输密钥, 还是会暴露

-   **非对称加密**, 有两个密钥, 一个公钥, 一个私钥. 如果用公钥对数据进行加密, 只有用对应的私钥才能解密; 如果用私钥对数据进行加密, 那么只有用对应的公钥才能解密
-   **非对称加密的算法是RSA算法**

#### SSL/TLS 握手过程图解

![](https://cdn.nlark.com/yuque/0/2021/png/223223/1630652479947-3e73fe87-a112-4e70-8c61-5331dff44b6b.png)

#### HTTPS 加密, 解密, 验证及数据传输过程

![](https://cdn.nlark.com/yuque/0/2021/png/223223/1630653708853-4692aad1-418a-40e8-afe7-28d165b55bff.png)