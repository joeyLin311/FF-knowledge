---
date created: 2022-07-01 16:35
---

## æ–¹æ¡ˆå¯¹æ¯”

=======

è™½ç„¶é¡¹ç›®ä¹Ÿæ²¡å•¥å—é‡è§†çš„ï¼Œä½†é¡¹ç›®æµç¨‹è¯¥æœ‰è¿˜æ˜¯è¦æœ‰çš„ã€‚é¦–å…ˆé€šè¿‡å®‰åˆ©æ‹‰äº†ä¿©ä¸ªæˆå‘˜å…¥ä¼™ã€‚ç®€å•è·Ÿå¤§å®¶å¼€ä¼šæ²Ÿé€šäº†ä¸€ä¸‹ï¼š

1. å¸‚é¢ä¸»æµæ–¹æ¡ˆè°ƒç ”

---

é¦–å…ˆï¼Œæåˆ° react è„šæ‰‹æ¶ï¼Œå¿…ç„¶ç¦»ä¸å¼€åœ¨ react ç¤¾åŒºå æ®ä¸»æµçš„`create-react-app`, ä½†å‡ºä¹æ„æ–™çš„è¢«å¤§å®¶ç¬¬ä¸€æ—¶é—´å°±æ’é™¤äº†ã€‚ä¸»è¦æ˜¯å› ä¸ºå®ƒé…ç½®ä¸å¤Ÿçµæ´»ï¼Œå¯¹`webpack`çš„å°è£…å¤ªæ­»ï¼Œè¿™è®©å®ƒåœ¨åº”å¯¹å¤æ‚é¡¹ç›®çš„æ—¶å€™ï¼Œæœ‰ç‚¹åŠ›ä¸ä»å¿ƒï¼Œè€Œä¸”è‡ªèº«æä¾›çš„åŠŸèƒ½è™½ç„¶è¯´å¾ˆé€šç”¨ä½†æ˜¯ä¹Ÿè¶³å¤Ÿç®€é™‹ã€‚æˆ‘çŒœè¿™æ—¶å€™ä¸€å®šä¼šæœ‰äººä¼šè¯´ï¼Œä½ å¯ä»¥`eject`ä¸€ä¸‹ï¼ŒæŠŠæºç æš´éœ²å‡ºæ¥å•Šï¼Ÿä½†è¿™æ ·çš„è¯ï¼Œæˆ‘ä½¿ç”¨å®ƒçš„æ„ä¹‰å°±æ²¡æœ‰äº†ï¼Œè€Œä¸”åŸºäºå®ƒçš„æºç äºŒæ¬¡å¼€å‘, æˆæœ¬è‚¯å®šä½ä¸äº†ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠç›®æ ‡è½¬å‘äº†`vue-cli`, æ²¡æƒ³åˆ°è·å¾—äº†å¤§å®¶çš„ä¸€è‡´å¥½è¯„ã€‚æˆ‘è®¤ä¸ºå®ƒæœ€ä¼˜ç§€çš„åœ°æ–¹æ˜¯äº: åœ¨åŠŸèƒ½çš„é€šç”¨æ€§åŠçµæ´»æ€§ï¼Œè¿™ä¸¤ä¸ªæŒ‡æ ‡ä¸Šå–å¾—äº†ä¸€ä¸ªå¾ˆå¥½çš„å¹³è¡¡ã€‚è¿™ç‚¹æ˜¯ä¸`vue.js`æ¡†æ¶çš„å“²å­¦æ˜¯é«˜åº¦ä¸€è‡´çš„ï¼Œæ‰€ä»¥ä¸`vue`ç»“åˆèµ·æ¥å¼€å‘é¡¹ç›®ï¼Œä¼šæœ‰ä¸€ç§è¡Œäº‘æµæ°´çš„æ„Ÿè§‰ï¼Œè€Œä¸”å¤§å®¶ä¸€è‡´å¯¹å®ƒçš„`cli`ï¼ˆäº¤äº’å‘½ä»¤è¡Œå·¥å…·ï¼‰å–œçˆ±æœ‰åŠ ï¼Œå°±æ˜¯ä¸‹è¾¹è¿™ä¸ªä¸œä¸œï¼Œç”¨è¿‡çš„äººä¸€å®šå°è±¡æ·±åˆ»ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/146cad965c1c448d8f293140eda6772f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

é‚£ä¹ˆï¼Œæˆ‘ä»¬çš„ç›®æ ‡ä¹Ÿå°±æœ‰äº†ï¼Œå¼€å‘ä¸€æ¬¾ä½¿ç”¨æ–¹å¼ç±»ä¼¼äº`vue-cli`çš„ react è„šæ‰‹æ¶ã€‚ä¹‹å‰å¯¹`@vue/cli`çš„è®¤è¯†åªåœç•™åœ¨ä½¿ç”¨å±‚é¢ï¼Œæ‰€ä»¥éœ€è¦å…ˆå¯¹å®ƒçš„å®ç°äº†è§£ä¸€æ³¢ã€‚æ­£æ‰€è°“ï¼ŒçŸ¥è‡ªçŸ¥å½¼ï¼Œæ‰å¥½å®ç°ï¼ˆæŠ„ï¼‰å˜›ã€‚

2. @vue/cli æºç åˆ†æ

---

æˆ‘ clone çš„æ˜¯ [4.5.14](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fvue-cli%2Ftree%2Fdev%2Fpackages%2F%2540vue%2Fcli "https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli") çš„ç‰ˆæœ¬ï¼Œ5.0 æ–°ç‰ˆæœ¬èµ·ç¬”æ—¶ï¼Œè€Œä¸”è¿˜å¤„åœ¨ beta ç‰ˆé˜¶æ®µï¼Œç•¥è¿‡ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e6832120c8f4755bce111b845b1ff5e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ•´ä½“çš„ä»£ç æ˜¯ä½¿ç”¨`lerna + yarn-workspace`ç»´æŠ¤çš„ï¼Œè€Œä¸”ä¸ vue æ­£å¼åŠŸèƒ½æœ‰å…³çš„åŒ…éƒ½åŒ…å«åœ¨äº†`@vue`è¿™ä¸ª npm åŸŸï¼ˆæœ‰äººä¹Ÿç§°ä¸º npm ç»„ç»‡ï¼‰ä¸‹ã€‚

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå®Œæ•´çš„`@vue/cli`åŠŸèƒ½ä¸»è¦æ˜¯ä¸‰éƒ¨åˆ†ç»„æˆçš„ï¼š

- `@vue/cli` è´Ÿè´£å‘½ä»¤è¡Œå‚æ•°æ”¶é›†
- `@vue/cli-service` è¿™ä¸ªåŒ…æ˜¯å¯åŠ¨ vue çš„å¼•æ“åŠæ ¸å¿ƒï¼Œæ‰¿è½½ webpack é…ç½®ã€‚
- `@vue/plugin-xxx` vue-cli çš„æ’ä»¶ï¼Œä¸€ä¸ªæ’ä»¶å¯¹åº”ä¸€ä¸ªåŠŸèƒ½ï¼Œä¸ä¸Šè¾¹ç”¨æˆ·è‡ªå®šä¹‰ feature é€‰é¡¹ä¸€ä¸€å¯¹åº”ã€‚

cli ä¸æ ¸å¿ƒåŠŸèƒ½åŒ…åˆ†ç¦»æ˜¯ä¸€ç§ä¸»æµçš„æ‹†åŒ…æ–¹å¼`webpack-cli & webpack`,`@babel/cli & @babel/core`çš†æ˜¯å¦‚æ­¤å®ç°çš„ï¼Œå±äºç¨‹åºè®¾è®¡ä¸Šçš„åˆ†å±‚æ¶æ„ï¼Œcliï¼ˆä¸Šå±‚ï¼‰éœ€è¦ä¾èµ–æ ¸å¿ƒæœåŠ¡ï¼ˆä¸‹å±‚ï¼‰ï¼Œä½†æ ¸å¿ƒæœåŠ¡ï¼ˆä¸‹å±‚ï¼‰å¹¶ä¸ä¾èµ– cliï¼ˆä¸Šå±‚ï¼‰ï¼Œä¾ç„¶å¯ä»¥ç‹¬ç«‹è¿è¡Œã€‚

é˜…è¯»æºç ç¬¬ä¸€æ­¥ï¼Œå…ˆä»`package.json`å…¥æ‰‹ã€‚è¿™ç§é€šè¿‡å‘½ä»¤ä½¿ç”¨çš„åŒ…ï¼Œéƒ½æ˜¯é€šè¿‡`package.json`çš„ [bin](https://juejin.cn/post/6844903870578032647#heading-15 "https://juejin.cn/post/6844903870578032647#heading-15") å­—æ®µæ¥å®ç°ã€‚

```jsx
  "bin": {
    "vue": "bin/vue.js"
  },
```

é¡ºè—¤æ‘¸ç“œï¼Œæ‰“å¼€`bin/vue.js`ï¼Œè¿™é‡Œ è¿™é‡Œä½¿ç”¨`Commander`è¿™ä¸ªå‘½ä»¤è¡Œè§£æå·¥å…·ï¼Œæ³¨å†Œäº†ä¸€äº›å…¨å±€å‘½ä»¤ï¼Œè¿™é‡Œåªæ³¨æ„`create`è¿™ä¸ªå‘½ä»¤å°± OKã€‚

åœ¨æ‰§è¡Œå…¨å±€çš„`vue create xxx`å‘½ä»¤æ—¶ï¼Œè¿è¡Œçš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶ã€‚ ![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2deb0d09f2f2431aafe91d05613c352e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?) å½“`vue create xxx`å‘½ä»¤è§¦å‘æ—¶ï¼Œä¼šæ‰§è¡Œ`../lib/create`è¿™ä¸ªæ–‡ä»¶ï¼Œä¼šæŠŠé¡¹ç›®åç§°`name`ä¼ è¿›å»ï¼Œç»§ç»­è¿½è¸ª`../lib/create.js`ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/153ab7f7d2364568b784e469b5565e2e~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

åœ¨`create`ä¸»å‡½æ•°ä¸­ã€‚é¦–å…ˆï¼Œæ‹¼ä¸€ä¸ªå°†è¦åˆ›å»ºé¡¹ç›®çš„ç›®æ ‡è·¯å¾„`targetDir`ï¼ˆè¿™é‡Œå¤§éƒ¨åˆ†æƒ…å†µæ˜¯ï¼Œæ•²`vue create`å‘½ä»¤æ—¶çš„æ‰€åœ¨ç›®å½• + ä¼ è¿›æ¥çš„é¡¹ç›®`name`ï¼‰ã€‚

ç´§æ¥ç€ï¼Œæ˜¯å¯¹ç£ç›˜å·²å­˜åœ¨åŒåé¡¹ç›®çš„å¤„ç†ã€‚æ¥ä¸‹æ¥æ˜¯é‡ç‚¹,`new Creator` è¿™ä¸ªç±»æ­£å¼å¼€å¯äº†åˆ›å»ºé¡¹ç›®çš„ä¸»æµç¨‹ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa678fcab86f4db9bd802e969d608e8d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ‰¾åˆ°è¿™ä¸ª`Creator`ç±»ï¼Œå¯ä»¥å‘ç°å®ƒç»§æ‰¿äº† node çš„`EventEmiter`è¿™ä¸ªäº‹ä»¶å¤„ç†ç±»ï¼Œè¿™ç‚¹æ˜¯ä¸ºäº†å®ç°å®ƒçš„æ•´ä¸ªæ’ä»¶æœºåˆ¶ï¼Œè¿™ç±»ä¼¼äºåœ¨ç¼–å†™ webpack çš„æ’ä»¶è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è®¢é˜…ä¸€äº›å†…éƒ¨æ´¾å‘çš„ä¸€äº› hookï¼Œå®ç°åŸºäºå‘å¸ƒè®¢é˜…çš„äº‹ä»¶æ¨¡å¼ï¼Œä¸‹è¾¹ä¼šç»†ç»†è®²è§£è¿™å—ã€‚

å¾€ä¸‹å°±éœ€è¦å¼€å¯æ–­ç‚¹è°ƒè¯•äº†ï¼Œå¸®åŠ©å°†å®ƒçš„æ•´ä¸ªè¿è¡Œæµç¨‹çœ‹çš„æ›´æ¸…æ¥šäº›ã€‚

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd2544344992438e98a15b26bf93dde8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

å·¦ä¾§çº¢æ¡†ä¸­çš„äº¤äº’é€‰é¡¹æ˜¯ä¸æ˜¯æ—¶æ›¾ç›¸ä¼¼ï¼Œæ²¡é”™ï¼Œå®ƒå¯¹åº”çš„äº¤äº’ç•Œé¢ï¼Œåœ¨ä¸Šè¾¹å‡ºç°è¿‡ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68950e66520f4098b0dc3f72674bb625~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

vue ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·é€‰æ‹©ï¼Œé¢„è®¾äº†ä¸€äº›åŠŸèƒ½é›†åˆï¼Œ`Creator`ç±»çš„`constuctor`é‡Œåªæ˜¯åˆå§‹åŒ–ä¸€äº›å±æ€§å˜é‡ï¼Œæ ¸å¿ƒçš„æ˜¯ç´§æ¥ç€è°ƒç”¨çš„`create`å®ä¾‹æ–¹æ³•ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd18f9d9b916455c9a88c4404c8b0407~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

è°ƒç”¨`promptAndResolvePreset` ï¼Œä¼šå¼¹å‡ºé¢„è®¾é€‰é¡¹ç•Œé¢ï¼Œâœ… ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼Œç»§ç»­ï¼›

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f8b9ce54f1624e60bbcd3caac5fe0c2c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

å·¦ä¾§å¯ä»¥çœ‹åˆ°`presets`è¿™ä¸ªè¡¨ç¤ºæ‰€é€‰é¢„è®¾çš„æ•°æ®é‡Œï¼Œå·²ç»åŒ…å«äº†é¢„è®¾é‡ŒåŒ…å«çš„`babelã€ eslint`ç­‰æ’ä»¶ã€‚

æ¢ä¸€ä¸ªé¢„è®¾ï¼Œé€‰æ‹©æ‰‹åŠ¨å‘¢ï¼Ÿå¦‚ä¸‹å›¾ï¼šå¾—åˆ°ä¹Ÿæ˜¯ç›¸åŒçš„æ•°æ®ç»“æ„ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7be6c48a7ea54c54b6c29514cb4cd03f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¥ä¸‹æ¥ï¼Œå°±æ˜¯ç»™`presets`é‡Œçš„`plugins`æ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªæ’ä»¶ï¼Œåˆå§‹åŒ–ä¸€äº›é»˜è®¤é€‰é¡¹

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06dc57cbffc64ec2b3ff8f93a60ad7c7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¥ä¸‹æ¥ï¼Œåˆå§‹åŒ–ç”Ÿæˆ `package.json` éœ€è¦çš„æ•°æ®ã€‚

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a78785cbca4a4c389e6d8201a3a154cf~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

å°†åˆšæ‰é¢„è®¾é‡ŒåŒ…å«çš„æ’ä»¶ï¼Œæ’å…¥`devDependencies`å¼€å‘ä¾èµ–ä¸­ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f3f5a5124cb40bea9710e240e1c7459~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ’å…¥æˆåŠŸ, è°ƒè¯•æ ˆé‡Œå·²ç»å¯ä»¥çœ‹åˆ°åŒ…å«äº† 3 ä¸ªå¼€å‘ä¾èµ–

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e5d333a641a4196971b94bdf3e10c60~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¥ä¸‹æ¥ï¼Œå°†`package.json`å†™å…¥ç£ç›˜ã€‚

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8562932fa31c47989c820448d821c047~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ‰§è¡Œ`npm install`ï¼Œå®‰è£…ä¾èµ–ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8830fd7281a433892e9e9e3258407d3~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¥ç€ï¼Œåˆåšäº†äº›ï¼šå†™å…¥`npmrcã€yarnrc`æ–‡ä»¶ï¼Œåˆå§‹åŒ–`git`ä»“åº“ç­‰ä¸€äº›æ— å…³ç´§è¦çš„äº‹æƒ…ï¼Œå¿«é€Ÿæ è¿‡ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9436af55901e409cbceb88f5b554b553~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

é‡ç‚¹æ¥äº†ï¼Œä¸‹é¢å°±è¦ä½¿ç”¨åˆšå®‰è£…å¥½çš„æ’ä»¶ï¼Œç”Ÿæˆé¡¹ç›®æ¨¡ç‰ˆäº†ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2fc1f993d8b847aa96dcec14e13f49df~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

`this.resolvePlugins(preset.plugins, pkg)`è¿™ä¸ªæ–¹æ³•å¾ˆå…³é”®ï¼Œç”¨æ¥å¼•å…¥æ’ä»¶ã€‚ä½†åœ¨ä»‹ç»è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆèŠä¸€èŠæ¡†æ¶çš„æ’ä»¶æœºåˆ¶ä»¥åŠå®ƒåœ¨`vue/cli`ä¸­çš„è®¾è®¡ä¸å®ç°ã€‚

### æ’ä»¶æœºåˆ¶

å°±æ˜¯å¯ä»¥å°†ä¸€äº›å¯é€‰é…æˆ–è€…ç”¨æˆ·éœ€è¦è‡ªå®šä¹‰çš„åŠŸèƒ½å°è£…èµ·æ¥ï¼Œ**æŒ‰éœ€æ’å…¥**ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡ä¼˜åŠ¿æ˜¯ï¼šå¯ä»¥æ‹†åˆ†ä»£ç å¤æ‚åº¦å’ŒåŠŸèƒ½è€¦åˆåº¦ï¼Œå¹¶ä¸”æå¤§çš„å¢åŠ äº†æ¡†æ¶çš„**å¯æ‰©å±•æ€§**ã€‚

æ’ä»¶ï¼Œé¦–å…ˆè¦å®šå¥½æ€ä¹ˆæ’ã€‚è¿™ä¹Ÿæ˜¯æ’ä»¶æœºåˆ¶æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œä¹Ÿå°±æ˜¯**æ¡†æ¶å¼€å‘è€…ä¸æ’ä»¶å¼€å‘è€…éœ€è¦çº¦å®šå¥½ä¸€å¥—æ’ä»¶æ¥å…¥çš„å›ºå®šæ–¹å¼**ã€‚ä½“ç°åœ¨ vue/cli ä¸­ï¼Œè¿™ç§çº¦å®šå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/616580a241db4a78a0897a446f2bb3ad~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¯ä¸€ä¸ªæ’ä»¶éƒ½æœ‰ä¸€ä¸ª`generator`æ–‡ä»¶å¤¹ï¼Œä¸‹è¾¹å¿…é¡»å­˜åœ¨ä¸€ä¸ª`index.js`ï¼Œç„¶å`index.js`éœ€è¦å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä½“é‡Œå¯ä»¥è°ƒç”¨å¤–éƒ¨ä¸»ä½“æ³¨å…¥çš„ä¸€äº›å·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚ï¼Œ

- `api.injectImport()` åœ¨é¡¹ç›®é‡Œæ’å…¥ä¸€ä¸ªæ¨¡å—å¯¼å…¥ã€‚
- `api.extendPackage()` æ‰©å±•é¡¹ç›®çš„ package.json
- `api.render('./template')` ä½¿ç”¨ ejs æ¸²æŸ“æ¨¡ç‰ˆæ–‡ä»¶ï¼ˆæ¡ä»¶ç¼–è¯‘ï¼‰

å†å›æ¥çœ‹ä¸Šè¾¹çš„`this.resolvePlugins(preset.plugins, pkg)`æ–¹æ³•ï¼Œè¿™é‡Œå–åˆ°çš„ applyï¼Œå…¶å®å°±æ˜¯æ’ä»¶çº¦å®šå¯¼å‡ºçš„é‚£ä¸ªå‡½æ•°ï¼Œä½†è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæ˜¯**æš‚æ—¶å°† apply æ–¹æ³•ä¿å­˜èµ·æ¥**ï¼Œå¹¶ä¸ä¼šè°ƒç”¨ã€‚

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/96764c9d852a453eada22d9cd6903a6a~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

åŸ`plugins`ï¼Œç»è¿‡æ­¤æ–¹æ³•å¤„ç†åï¼Œå°±è½¬æ¢ä¸ºäº†æ–°çš„åŒ…å«å…·ä½“æ’ä»¶åŠŸèƒ½çš„`plugins`ã€‚\
{id: options} => [{ id, apply, options }]

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0416bf80894947acaeb8680c880c0078~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¥ä¸‹æ¥ï¼Œå°†æ•´ç†å¥½çš„ plugins ä¼ å…¥`Generator`è¿™ä¸ªç±»ä¸­ï¼Œå¼€å§‹äº†æœ€åä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€å®è´¨çš„ä¸€æ­¥ï¼š**ç”Ÿæˆé¡¹ç›®**ã€‚

å¯ä»¥è¿™æ ·è¯´ï¼Œä¹‹å‰ä¸€å¤§å †çš„å‚æ•°æ”¶é›†ã€æ•´ç†ã€å¼•å…¥æ’ä»¶ç­‰å‡†å¤‡å·¥ä½œéƒ½æ˜¯ä¸ºäº†æœ€ç»ˆçš„ç”Ÿæˆè¿™ä¸€æ­¥ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16c4e697af3d475998f3f2aaa7158d73~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

`new` ä¹‹åï¼Œç´§æ¥ç€è°ƒäº†`generate`è¿™ä¸ªå®ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ï¼Œé‡ç‚¹çœ‹ä¸‹è¿™ä¸ªæ–¹æ³•çš„å®ç°

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aee0794391ea4ef0a6598cfa0620a0e7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ–¹æ³•æ‰§è¡Œï¼Œé¦–å…ˆè°ƒç”¨äº†`this.initPlugins()`ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­æœ€é‡è¦çš„å°±æ˜¯éå†æ‰§è¡Œæ‰€æœ‰æ’ä»¶é»˜è®¤çš„ apply æ–¹æ³•ï¼ˆå³å‰è¾¹æåˆ°çš„æ’ä»¶æœºåˆ¶ä¸­çº¦å®šé»˜è®¤å¯¼å‡ºçš„é‚£ä¸ªå‡½æ•°ï¼‰ï¼Œ`apply`ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`api`, åŒ…å«äº†`render`æ¸²æŸ“ ejs æ¨¡ç‰ˆç­‰è¿™äº›èƒ½åŠ›, è€Œè¿™äº›èƒ½åŠ›éƒ½æ¥è‡ª`GeneratorAPI`è¿™ä¸ªç±»ï¼Œæ³¨æ„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¼šæŠŠå½“å‰`this`ä¼ å…¥ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ee1add1598a456e9d54304d663b11af~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¥ä¸‹æ¥ï¼Œç»§ç»­çœ‹`GeneratorAPI`çš„å®ç°ã€‚å…ˆæ’é™¤ä¸‹`@vue/cli-service`è¿™ä¸ªåŒ…ï¼Œå› ä¸ºè¿™ä¸ªåŒ…è™½ç„¶å­˜åœ¨äº`plugins`æ•°ç»„ä¸­ï¼Œä½†å®ƒå´å¾ˆç‰¹æ®Šï¼Œå®ƒå±äºæ ¸å¿ƒæœåŠ¡ï¼Œä¸¥æ ¼æ„ä¹‰ä¸Šå¹¶ä¸å±äºæ’ä»¶çš„èŒƒç•´ï¼Œä¸éœ€è¦å½“æ’ä»¶å¤„ç†ï¼Œåªéœ€å‚ä¸å®‰è£…å°±è¡Œï¼Œè¿™é‡Œæˆ‘çŒœåªæ˜¯è®©æ•°æ®ç»“æ„å°½é‡ä¿æŒç®€å•ï¼Œç”¨æ—¶å€™è¿‡æ»¤ä¸€ä¸‹ä¹Ÿæ²¡æœ‰å¾ˆéº»çƒ¦ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09432debba6f4df186a459960ea59567~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

`GeneratorAPI`çš„æ•´ä½“å®ç°é‡‡ç”¨äº†ä¸€ç§ä¸­é—´ä»¶çš„è®¾è®¡ï¼Œå…¶ä¸Šçš„ `_injectFileMiddleware` æ–¹æ³•ï¼Œä¼šå°† api ä¸Šçš„æ–¹æ³•è°ƒç”¨ä»¥ push ä¸€ä¸ªå‡½æ•°çš„æ–¹å¼å…ˆå­˜èµ·æ¥ï¼Œæš‚ä¸æ‰§è¡Œã€‚

æ‹¿ä¸Šè¾¹è®²åˆ°çš„`api.render()`æ¸²æŸ“æ¨¡ç‰ˆæ–¹æ³•ä¸¾ä¾‹ï¼Œåœ¨è°ƒç”¨æ’ä»¶å¯¼å‡ºçš„`apply`æ–¹æ³•æ—¶ï¼Œç¡®å®ä¼šè§¦å‘`api.render()`è°ƒç”¨, ä½†å´å¹¶ä¸ä¼šçœŸæ­£çš„ä½¿ç”¨`ejs`ç¼–è¯‘æ¨¡ç‰ˆæ–‡ä»¶ï¼Œè€Œæ˜¯å°†ä»–ä»¬æš‚å­˜åˆ°`this.generator.fileMiddlewares`è¿™ä¸ªä¸­é—´æš‚å­˜æ•°ç»„ä¸­ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cadf0a885b2b406a8bd774b9e3a3ea36~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/429786c6d2374263a9cd63dfba2f5237~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

é‚£ä¹ˆ`api.render()`è¿™äº›æ–¹æ³•çœŸæ­£çš„èµ·ä½œç”¨æ˜¯åœ¨å“ªé‡Œå‘¢ï¼Ÿ

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9a1b2da69f44091bfa127ac4610e9b2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ‰“å¼€ç´§æ¥ç€æ‰§è¡Œçš„ `this.resolveFiles` æ–¹æ³•ï¼ŒçœŸç›¸å°±åœ¨è¿™é‡Œã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/238e22dfaa9e45d9b91c98eede07e451~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

ç”¨`for of`ä¸²è¡Œè°ƒç”¨æ¯ä¸€ä¸ª`middleware`å‡½æ•°ï¼Œå¾—åˆ°æœ€ç»ˆéœ€è¦ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4b0a3c3503c942eeb813afa8b4fedfb7~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ­¤åˆ»ï¼Œ`this.files` å°±ä¿å­˜äº†å®Œæ•´çš„**æ–‡ä»¶è·¯å¾„**åˆ°**æ–‡ä»¶å†…å®¹**çš„æ˜ å°„, å¦‚ä¸Šå›¾å·¦ä¾§æ‰€ç¤ºã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f06b3a79953c4e86ad935fbc84061b82~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¥ä¸‹æ¥ï¼Œæ˜¯ä¸€äº›å¸¸è§„æ“ä½œã€‚`sortPkg` å¯ä»¥å¯¹`package.json`çš„ä¾èµ–æ•´ç†ä¸‹é¡ºåºï¼Œæ»¡è¶³ä¸‹ä¸€äº›å¼ºè¿«ç—‡ er çš„æ„Ÿå—ã€‚

æ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®`this.files`ï¼Œè°ƒç”¨ `writeFileTree` å¾€ç£ç›˜æ„‰å¿«çš„å†™æ–‡ä»¶äº†ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/46b5d2bf2d664998a6f44df836e4a45c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æœ€ç»ˆç”Ÿæˆçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œæµç¨‹ä»‹ç»å®Œæ¯•ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41fb1a6d24d74ceab4d1f8e7147b81c2~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

3. ç¡®å®šåŠŸèƒ½åŠç›®æ ‡

---

å‰è¾¹çš„å¯¹`@vue/cli`çš„è¯¦ç»†åˆ†æï¼Œå¯ä»¥æ€»ç»“ä¸ºå…³é”®çš„ä¸‰ç‚¹

- 1. é‡‡ç”¨**å‘½ä»¤è¡Œç•Œé¢**çš„è¿›è¡ŒåŠŸèƒ½é€‰æ‹©
- 2. `cli` ä¸ `æ ¸å¿ƒæœåŠ¡` @vue/cli-serviceï¼ˆwebpack é…ç½®ï¼‰é‡‡ç”¨åˆ†å±‚è®¾è®¡ï¼Œ**ç‹¬ç«‹å‘åŒ…**
- 3. **æ’ä»¶æœºåˆ¶**ï¼ŒæŒ‰éœ€ç”Ÿæˆä¸åŒçš„åŠŸèƒ½æ¨¡ç‰ˆæ–‡ä»¶

è¿™æ ·çš„è®¾è®¡å¯¹ä¸€ä¸ªé¢å‘æ‰€æœ‰ vue å¼€å‘è€…çš„è„šæ‰‹æ¶è€Œè¨€æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå®ƒéœ€è¦å…·å¤‡éå¸¸å¤§çš„çµæ´»æ€§ã€‚ä½†å¯¹ä¸€æ¬¾åªæ»¡è¶³ç‰¹å®šå›¢é˜Ÿçš„è„šæ‰‹æ¶æ¥è¯´ï¼Œæ˜¯è¿‡äºå¤æ‚çš„ï¼Œè€Œä¸”å¼€å‘æˆæœ¬ä¹Ÿä¼šå¾ˆé«˜ï¼Œå…‰æ˜¯å°†å„ç§åŠŸèƒ½æ’ä»¶æ‹†åˆ†å°±éœ€è¦éå¸¸å¤§çš„å·¥ä½œé‡ã€‚å…¶æ¬¡ï¼Œå›¢é˜Ÿçš„é¡¹ç›®å¼€å‘ï¼Œæœ€é‡è¦çš„å°±æ˜¯ç»Ÿä¸€ä¸è§„èŒƒï¼Œå¾ˆå¤šé…ç½®åŠåŠŸèƒ½éƒ½å¯ä»¥æ˜¯é»˜è®¤å†…ç½®çš„ï¼Œæ¯”å¦‚ eslintã€babelã€css å¤„ç†å™¨ï¼Œè¿™äº›éƒ½æ˜¯å›¢é˜Ÿé¡¹ç›®å¼€å‘ä¸­å¿…å¤‡çš„åŠŸèƒ½ï¼Œæ‰€ä»¥**é…ç½®çš„å¤šæ ·æ€§åŠçµæ´»æ€§å¹¶ä¸æ˜¯é¦–è¦è€ƒè™‘å› ç´ **ã€‚æ‰€ä»¥ï¼Œç¬¬ä¸‰ç‚¹æ’ä»¶æœºåˆ¶å¯ä»¥èˆå»ã€‚

cli ä¸ webpack é…ç½®åˆ†ç¦»ï¼Œè¿™æ ·å¯ä»¥åšåˆ°ä¸¤è€…çš„**ç‹¬ç«‹ç‰ˆæœ¬æ›´æ–°**ï¼Œæœ‰åˆ©äºç”¨æˆ·é¡¹ç›®çš„æŒç»­ç»´æŠ¤ï¼Œä½†è¿™æ ·åšçš„æˆæœ¬åœ¨äºéœ€è¦è‡ªå·±å®šä¹‰ä¸€å¥—ä¸`webpack`é…ç½®å¤§ä¸ä¸€æ ·çš„é…ç½®çº¦å®šå‡ºæ¥ï¼Œè¿™ä¸ªåœ¨`@vue/cli-service` ä¸­æ˜¯ä½¿ç”¨`vue.config.js`ä½œä¸ºé…ç½®æ–‡ä»¶, å…¶ä»–ä¸»æµçš„è„šæ‰‹æ¶æ¯”å¦‚`create-react-app`éƒ½æ˜¯èµ°çš„è¿™ä¸ªè·¯å­ã€‚è¿™æ ·çš„è¯ï¼Œå°±è¿˜éœ€è¦æœ‰ä¸€ä»½è¯¦ç»†çš„è„šæ‰‹æ¶é…ç½®çš„æ–‡æ¡£ï¼Œé€šè¿‡é…ç½®è„šæ‰‹æ¶å»é…ç½® webpackï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬å·²æŒæ¡çš„ webpack é…ç½®çŸ¥è¯†æ— ç”¨æ­¦ä¹‹åœ°ï¼Œvue ä¸­é‡‡ç”¨çš„`chainWebpack`æ˜¯ä¸ªè§£å†³åŠæ³•ï¼Œä½†ç©¶ç«Ÿå®ƒæœ‰å¤šéš¾ç”¨ï¼Œåªæœ‰ç”¨è¿‡çš„äººæ‰èƒ½ä½“ä¼šåˆ°ã€‚æˆ‘ä»¬ä¹Ÿè®¸åªéœ€è¦ä¸€æ¬¾é€æ˜çš„`webpack`é…ç½®ï¼Œæ‰€æœ‰çš„`rulesã€plugins`éƒ½æ˜¯å¯ä»¥ç›´æ¥ä¿®æ”¹çš„ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ–‡æ¡£ï¼Œåªéœ€è¦ä¼š webpack é…ç½®å°±èƒ½æå®šä¸€åˆ‡ï¼Œè€Œä¸”ï¼Œè¿™ä»½ webpack é…ç½®åœ¨æˆ‘ä»¬çš„å›¢é˜Ÿå°±æ˜¯ç°æˆçš„ï¼Œæ‰€ä»¥ä¸Šè¾¹æåˆ°çš„ç¬¬äºŒç‚¹ä¹Ÿä¸éœ€è¦ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦å€Ÿé‰´çš„åœ°æ–¹å°±ä¸»è¦åœ¨äºäº¤äº’å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿˜æœ‰æŒ‰éœ€è¿›è¡Œ ejs æ¨¡ç‰ˆç¼–è¯‘ã€‚åŒæ—¶ç»“åˆæˆ‘ä»¬å›¢é˜Ÿçš„é¡¹ç›®ç‰¹ç‚¹è¿›è¡ŒåŠŸèƒ½æç‚¼ï¼Œç»è¿‡å°ä¼™ä¼´çš„è®¨è®ºï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹é€‰æ‹©ï¼š

### ï¼ˆ1ï¼‰ ç§»åŠ¨ç«¯è¿˜æ˜¯ PC ç«¯?

PC ç«¯ä¼šå†…ç½®åŸºäº`antd`çš„å¸ƒå±€æ¨¡ç‰ˆï¼Œç§»åŠ¨ç«¯ä¼šå¼€å¯`px2rem`é€‚é…ï¼Œhtml é‡Œå†…è” `flexible.js`è„šæœ¬ã€‚

### ï¼ˆ2ï¼‰ ç”Ÿæˆå•é¡µ or å¤šé¡µæ¨¡ç‰ˆ?

`MPA`ä¸`SPA`çš„éœ€æ±‚åœ¨æˆ‘ä»¬çš„é¡¹ç›®åœºæ™¯ä¸­éƒ½æ˜¯å­˜åœ¨çš„ï¼Œæ‰€ä»¥åœ¨è„šæ‰‹æ¶å±‚é¢å»åŒºåˆ†ä¸¤è€…è¿˜æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚

### ï¼ˆ3ï¼‰ çŠ¶æ€ç®¡ç†åº“ã€react-router ç‰ˆæœ¬æŒ‰éœ€å®‰è£…

## åŠŸèƒ½å¼€å‘

====

### åˆå§‹åŒ–é¡¹ç›®

- monorepo

å®ƒç›¸æ¯”å•ä»“åº“çš„ä¼˜åŠ¿æ˜¯åœ¨äºæœ‰åˆ©äºå¤šä¸ª npm ä¹‹é—´çš„é«˜æ•ˆè”è°ƒåŠ`node_modules`ç£ç›˜ç©ºé—´å…±äº« ç”±äº lerna çš„ä¾èµ–æå‡å¯¹ä¾èµ–ç‰ˆæœ¬å·è¦æ±‚è¿‡äºä¸¥æ ¼ï¼Œè€Œä¸”ç¼ºå°‘å¾ˆå¤š`yarn-workspace`ç‹¬æœ‰çš„åŠŸèƒ½ (ç‰¹åˆ«æ˜¯å¯¹ binã€module çš„æœ¬åœ°è½¯é“¾å¤„ç†)ã€‚ç›®å‰ä¸»æµçš„å®è·µæ˜¯ï¼Œåˆ©ç”¨`yarn`çš„`workspace`åšä¾èµ–ç®¡ç†ï¼Œ`lerna`åš npm åŒ…çš„è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†åŠå‘åŒ…ã€‚ è¿™é‡Œé‡‡ç”¨`monorepo`çš„åŸå› æ˜¯ï¼Œåç»­å¯èƒ½ä¼šåŸºäºè¿™ä¸ªè„šæ‰‹æ¶å¼€å‘ç»„ä»¶åº“æˆ–è€… webpack-plugin ç­‰é¡¹ç›®ï¼Œæ–¹ä¾¿ä»–ä»¬ä¹‹é—´çš„è”è°ƒã€‚

```bash
npm i -g lerna
lerna init
```

**lerna.json**

```bsh
{
  "packages": [
    "packages/*"
  ],
  "version": "0.1.6",
  "npmClient": "yarn",
  "useWorkspaces": true
}


```

package.json

```json
   ...
  "workspaces": [ 
    "packages/*"
  ],
  ...


```

åˆ›å»º cli åŒ…

```bash
lerna create react-booster-cli
```

åˆå§‹åŒ–ä¸‹é¡¹ç›®

```bash
yarn install 
```

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3fe0923143d429ab09289ed86da400d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

æ¥ä¸‹æ¥å°±æ˜¯å®ç° cli çš„åŠŸèƒ½ï¼Œé¦–å…ˆåœ¨åˆ†æ vue/cli æºç æ—¶æåˆ°äº†ï¼Œå…¨å±€åŒ…ç”¨åˆ°çš„å…¨å±€å‘½ä»¤ï¼Œæ˜¯é€šè¿‡`package.json`çš„`bin`å­—æ®µå®ç°çš„ï¼Œå’±ä»¬ä¹Ÿä¸€æ ·ã€‚

```json
booster/packages/react-booster-cli/package.json
  "bin": {
    "booster": "bin/booster.js"
  },

```

æ¥ä¸‹æ¥åˆ›å»º`./bin/booster.js`æ–‡ä»¶

```jsx
#!/usr/bin/env node
// å‘½ä»¤è¡Œè§£æå·¥å…·
const program = require('commander');

program
  .version(require("../package").version)
  .usage("<command> [options]");
  
  
  program.command("create <project-name>")
  .description("åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®")
  .action((projectName)=>{
    require('../lib/create')(projectName)
  })

  program.parse(process.argv);  
```

`#!/usr/bin/env node`è¿™å¥éå¸¸é‡è¦ï¼Œå£°æ˜æ­¤æ–‡ä»¶éœ€è¦ä½¿ç”¨`node`ç¨‹åºæ¥æ‰§è¡Œã€‚é‡Œè¾¹ç”¨åˆ°äº†`commander`è¿™ä¸ªå‘½ä»¤è¡Œå‚æ•°è§£æåº“ï¼Œå®‰è£…ä¸€ä¸‹

```bash
yarn workspace react-booster-cli add commander
```

ç°åœ¨å°±å¯ä»¥æµ‹è¯•è·‘é€šä¸‹å’±ä»¬çš„æµç¨‹äº†, åœ¨ booster æ ¹ç›®å½•æ‰§è¡Œ

```bash
npx booster
```

å‡ºç°ä»¥ä¸‹ç•Œé¢å°±ç®—æˆåŠŸäº†

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/179d6c697f194349814340f6103909fa~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

ä¹Ÿè®¸æœ‰äººä¼šå¥½å¥‡è¿è¡ŒæˆåŠŸçš„åŸå› ï¼Œæˆ‘è¿™é‡Œç®€å•è§£é‡Šä¸‹ï¼Œé¦–å…ˆï¼Œ`npx xxx`ä¼šå…ˆå»å½“å‰ç›®å½•ä¸‹çš„`node_modules/.bin/`ç›®å½•ä¸‹æ‰¾ xxx æ–‡ä»¶ã€‚å¾ˆæ˜¾ç„¶ï¼Œæ˜¯å­˜åœ¨çš„ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢? è™½ç„¶å£°æ˜äº†å…¨å±€å‘½ä»¤ï¼Œä½†å†™çš„ cli åŒ…ï¼Œä¸€æ²¡å‘åŒ…ï¼ŒäºŒæ²¡å®‰è£…ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7a8c5ad2dbc84a07bfbca1d4a37fe29d~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

å…¶å®è¿™æ˜¯`yarn install` çš„ä¸€ä¸ªé™„å¸¦ï¼ˆè¶…å¥½ç”¨çš„ï¼‰åŠŸèƒ½ï¼Œå‡†ç¡®è¯´æ˜¯é€šè¿‡ä½¿ç”¨`workspace`ï¼Œ`yarn install`ä¼šè‡ªåŠ¨çš„å¸®å¿™è§£å†³å®‰è£…å’Œ link é—®é¢˜ï¼ŒåŸç†æ˜¯åœ¨`node_modules/.bin`ç›®å½•ä¸‹åˆ›å»ºè½¯é“¾ï¼ˆç±»ä¼¼äº win ä¸Šçš„æ–‡ä»¶å¿«æ·æ–¹å¼ï¼‰ï¼Œé“¾æ¥åˆ°äº†`packages/react-booster-cli/bin/booster.js`ã€‚

æ¥ä¸‹æ¥æ‰§è¡Œ `create` å‘½ä»¤ä¼šèµ° comander çš„`action`ï¼Œå°†é¡¹ç›®åä¼ åˆ° create æ–‡ä»¶é‡Œçš„ create æ–¹æ³•ä¸­ï¼Œè¿™ä¸ vue/cli æ˜¯ä¸€è‡´çš„

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6660fbe402f4a93bd194f0a49058d06~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

### åŠŸèƒ½å®ç°

#### å®ç° create æ–¹æ³•

è¿™é‡Œéœ€è¦å¾ˆå¤šåš cli å¸¸ç”¨çš„ä¸€äº›å·¥å…·åŒ…ï¼Œæ¯ä¸ªå·¥å…·çš„ç”¨é€”ä¸‹è¾¹éƒ½æœ‰æ³¨é‡Šè¯´æ˜ï¼Œå¾ˆå¤šå…¶å®éƒ½æ˜¯ç”¨æ¥ä½¿å‘½ä»¤è¡Œæ›´åŠ ç¾è§‚çš„ã€‚ä¹Ÿè®¸ npm ç”Ÿæ€é‡Œå¤§éƒ¨åˆ†éƒ½æ˜¯å‰ç«¯å¼€å‘è€…ï¼Œåƒè¿™æ ·è£…é¥°å‘½ä»¤è¡Œçš„åŒ…ç§ç±»å’Œæ•°é‡éƒ½æ ¼å¤–ä¸°å¯Œã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨`ora`ã€`chalk`å¾ˆæ–¹ä¾¿å®ç°ä¸€äº›å‘½ä»¤è¡ŒåŠ è½½æ•ˆæœã€é¢œè‰²å­—ä½“ä»¥åŠè¿›åº¦æ¡ï¼Œå¢åŠ å‘½ä»¤è¡Œçš„ç”¨æˆ·ä½“éªŒã€‚

**`lib/create.js`**

```jsx
const path = require("path");
const fs = require("fs");
// æ£€æµ‹ç›®å½•æ˜¯å¦å­˜åœ¨
const exists = fs.existsSync;
// åˆ é™¤æ–‡ä»¶
const rm = require("rimraf").sync;
//è¯¢é—®cliè¾“å…¥å‚æ•°
const ask = require("./ask");
// å‘½ä»¤è¡Œäº¤äº’å·¥å…·
const inquirer = require("inquirer");
// å‘½ä»¤è¡Œloading
const ora = require("ora");
// è¾“å‡ºå¢è‰²
const chalk = require("chalk");
// æ£€æµ‹ç‰ˆæœ¬
const checkVersion = require("./check-version");

const generate = require("./generate");

const { writeFileTree } = require("./util/file");
const runCommand = require("./util/run");

// loading
const spinner = ora();
async function create(projectName) {
  const cwd = process.cwd(); //å½“å‰è¿è¡Œnodeå‘½ä»¤çš„ç›®å½•
  const projectPath = path.resolve(cwd, projectName);
  // å‡å¦‚å½“å‰å·²å­˜åœ¨åŒåé¡¹ç›®ï¼Œè¯¢é—®æ˜¯å¦è¦†ç›–
  if (exists(projectPath)) {
    const answers = await inquirer.prompt([
      {
        type: "confirm",
        message: "Target directory exists. Do you want to replace it?",
        name: "ok",
      },
    ]);
    if (answers.ok) {
      console.log(chalk.yellow("Deleting old project ..."));
      rm(projectPath);
      await create(projectName);
    }
  } else {

    // æ”¶é›†ç”¨æˆ·è¾“å…¥é€‰é¡¹
    const answers = await ask();
    spinner.start("check version");
    // æ£€æµ‹ç‰ˆæœ¬
    await checkVersion();
    spinner.succeed();
    console.log(`âœ¨  Creating project in ${chalk.yellow(projectPath)}.`);
    // console.log(answers);
    // æ›´æ–° package.json
    const pkg = require("../template/package.json");

    // ç”Ÿæˆé¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œapp.config.json
    const appConfig = {};
    const { platform, isMPA, stateLibrary,reactRouterVersion } = answers;
    if (platform === "mobile") {
      pkg.devDependencies["postcss-pxtorem"] = "^6.0.0";
      pkg.dependencies["lib-flexible"] = "^0.3.2";
    } else if (platform === "pc") {
      pkg.dependencies["antd"] = "latest";
    }
    pkg.dependencies[stateLibrary] = "latest";
    if (reactRouterVersion === "v5") {
      pkg.devDependencies["react-router"] = "5.1.2";
    } else if (reactRouterVersion === "v6") {
      pkg.dependencies["react-router"] = "^6.x";
    }

    appConfig.platform = platform;

    spinner.start("rendering template");
    const filesTreeObj = await generate(answers,projectPath);
    spinner.succeed();
    spinner.start("ğŸš€ invoking generators...");
    await writeFileTree(projectPath, {
      ...filesTreeObj,
      "package.json": JSON.stringify(pkg, null, 2),
      "app.config.json": JSON.stringify(appConfig, null, 2),
    });
    spinner.succeed();
    console.log(`ğŸ—ƒ  Initializing git repository...`)
    await runCommand('git init')
    
    console.log();
    console.log(
      `ğŸ‰  Successfully created project ${chalk.yellow(projectName)}.`
    );
    console.log(
        `ğŸ‘‰  Get started with the following commands:\n\n` +
          chalk.cyan(` ${chalk.gray("$")} cd ${projectName}\n`) +
          chalk.cyan(` ${chalk.gray("$")} npm install or yarn\n`) +
          chalk.cyan(` ${chalk.gray("$")} npm run dev`)
      );
    console.log();
     
    
  }
}

module.exports = (...args) => {
  return create(...args).catch((err) => {
    spinner.fail("create error");
    console.error(chalk.red.dim("Error: " + err));
    process.exit(1);
  });
};


```

#### æ£€æµ‹ç‰ˆæœ¬

`lib/check-version.js`

```jsx
const request = require('request')
const semver = require('semver')
const chalk = require('chalk')
const packageConfig = require('../package.json')


module.exports = function checkVersion() {
    return new Promise((resolve,reject)=>{
        if (!semver.satisfies(process.version, packageConfig.engines.node)) {
            return console.log(chalk.red(
              `  You must upgrade node to >= ${packageConfig.engines.node} .x to use react-booster-cli`
            ))
          }
          request({
            url: 'https://registry.npmjs.org/react-booster-cli',
          }, (err, res, body) => {
            if (!err && res.statusCode === 200) {
              const latestVersion = JSON.parse(body)['dist-tags'].latest
              const localVersion = packageConfig.version
              if (semver.lt(localVersion, latestVersion)) {
                console.log()
                console.log(chalk.yellow('  A newer version of booster-cli is available.'))
                console.log()
                console.log(`  latest:     ${chalk.green(latestVersion)}`)
                console.log(`  installed:  ${chalk.red(localVersion)}`)
                console.log()
              }
              resolve()
            }else{
              reject()
            }
          })
    })
}



```

#### å‘½ä»¤è¡ŒåŠŸèƒ½é€‰æ‹©

æ ¸å¿ƒæ˜¯åˆ©ç”¨`inquirer`è¿™ä¸ªåŒ…ï¼Œæ¥å®ç°å‘½ä»¤è¡Œäº¤äº’ç•Œé¢ï¼Œè¿™ä¸ªåŒ…éå¸¸å¼ºå¤§ï¼Œæä¾›äº†å•é€‰ã€å¤šé€‰ã€è¾“å…¥æ¡†ç­‰äº¤äº’æ–¹å¼ï¼Œæ´»è„±è„±ä¸€ä¸ªå‘½ä»¤è¡Œ`form`å•Š!

lib/ask.js

```jsx
const { prompt } = require('inquirer');//ç”Ÿæˆå‘½ä»¤è¡Œäº¤äº’ç•Œé¢

const questions = [
  {
    name: 'platform',
    type: 'list',
    message: 'æ‚¨çš„webåº”ç”¨éœ€è¦è¿è¡Œåœ¨å“ªä¸ªç«¯å‘¢?',
    choices: [{
      name: 'PCç«¯',
      value: 'pc',
    }, {
      name: 'ç§»åŠ¨ç«¯',
      value: 'mobile',
    }]
  },
  {
    name: 'isMPA',
    type: 'list',
    message: 'ç”Ÿæˆå•é¡µorå¤šé¡µæ¨¡ç‰ˆ?',
    choices: [{
      name: 'å•é¡µï¼ˆSPAï¼‰',
      value: false,
    }, {
      name: 'å¤šé¡µï¼ˆMPAï¼‰',
      value: true,
    }]
  },
  {
    name: 'stateLibrary',
    type: 'list',
    message: 'æ‚¨å¸Œæœ›å®‰è£…çš„çŠ¶æ€ç®¡ç†åº“æ˜¯?',
    choices: [{
      name: 'mobx',
      value: 'mobx',
    }, {
      name: 'redux',
      value: 'redux',
    }]
  },
  {
    name: 'reactRouterVersion',
    type: 'list',
    message: 'é€‰æ‹©react-routerç‰ˆæœ¬',
    choices: [{
      name: 'v5ï¼ˆæ¨èï¼‰',
      value: 'v5',
    }, {
      name: 'v6ï¼ˆå¯¹hookæ”¯æŒåº¦è¾ƒå¥½,ä½†apiä¸å¤Ÿç¨³å®šï¼‰',
      value: 'v6',
    }]
  },
]

module.exports = function ask () {
  return prompt(questions)
}


```

#### ç”Ÿæˆé¡¹ç›®æ–‡ä»¶

`lib/generate.js`

```jsx
const { isBinaryFileSync } = require("isbinaryfile");
const fs = require("fs");
const ejs = require("ejs");
const path = require("path");

/**
 * @name æ¸²æŸ“æ–‡ä»¶
 * @param {*} filePath æ–‡ä»¶è·¯å¾„
 * @param {*} ejsOptions ejsæ³¨å…¥æ•°æ®å¯¹è±¡
 * @returns æ–‡ä»¶å†…å®¹
 */
function renderFile(filePath, ejsOptions = {}) {
  // äºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥è¿”å›
  if (isBinaryFileSync(filePath)) {
    return fs.readFileSync(filePath);
  }
  const content = fs.readFileSync(filePath, "utf-8");

  //srcç›®å½•ä¸‹éœ€è¦ç»è¿‡ejsåŠ¨æ€ç¼–è¯‘
  if (/[\\/]src[\\/].+/.test(filePath)) {
    return ejs.render(content, ejsOptions);
  }
  // å…¶ä»–æ–‡ä»¶ï¼Œæ¯”å¦‚webpackçš„é…ç½®æ–‡ä»¶ï¼Œç›´æ¥è¯»å–è¿”å›
  return content;
}

/**
 * @name ç”Ÿæˆé¡¹ç›®æ–‡ä»¶
 * @param {*} answers æ”¶é›†çš„é—®é¢˜
 * @returns æ–‡ä»¶æ ‘ eg { '/path/a/b' : æ–‡ä»¶å†…å®¹ }
 */
async function generate(answers, targetDir) {
  const globby = require("globby");

  // åŒ¹é…è„šæ‰‹æ¶æ–‡ä»¶å¤¹æ‰€æœ‰æ–‡ä»¶
  const fileList = await globby(["**/*"], {
    cwd: path.resolve(__dirname, "../template"),
    gitignore: true,
    dot: true,
  });
  const { isMPA } = answers;
  // ejsæ³¨å…¥çš„æ¨¡ç‰ˆå˜é‡
  const ejsData = {
    ...answers,
    projectDir: targetDir,
    pageName:'index'
  };
  // ç”Ÿæˆæ–‡ä»¶æ ‘å¯¹è±¡
  const filesTreeObj = {};
  fileList.forEach((oriPath) => {
    let targetPath = oriPath;
    const absolutePath = path.resolve(__dirname, "../template", oriPath);
  
    if (isMPA && /^src[\\/].+/.test(oriPath)) {
      // é’ˆå¯¹å¤šé¡µåœºæ™¯ï¼Œç”Ÿæˆå¤šé¡µé¢æ¨¡ç‰ˆ
      const [dir, file] = oriPath.split(/[\\/]+/);
      ["index", "pageA", "pageB"].forEach((pageName) => {
        targetPath = `${dir}/pages/${pageName}/${file}`;
        filesTreeObj[targetPath] = renderFile(absolutePath, {
          ...ejsData,
          pageName,
        });
      });
    } else {
      const content = renderFile(absolutePath, ejsData);
      filesTreeObj[targetPath] = content;
    }
  });

  return filesTreeObj;
}

module.exports = generate;



```

**å°†å‘½ä»¤è¡Œæ”¶é›†åˆ°çš„å‚æ•°æ³¨å…¥åˆ° ejs æ¨¡ç‰ˆä¸­**

æ¯”å¦‚åœ¨å‘½ä»¤è¡Œé€šè¿‡ç”¨æˆ·äº¤äº’æ”¶é›†åˆ°`platform`è¿™ä¸ªä»£è¡¨ web å¹³å°çš„å‚æ•°ã€‚

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c7127b65e124d0fbbe2f723f2dff370~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

ejs æ¸²æŸ“æ—¶ï¼Œ `platform = mobile`ï¼Œä»£è¡¨é€‰æ‹©æ˜¯ç§»åŠ¨ç«¯ï¼Œå°±åœ¨ html æ¨¡ç‰ˆä¸­çš„ head æ ‡ç­¾ä¸­æ’å…¥`flexible.js`çš„è„šæœ¬ï¼ŒPC çš„è¯ï¼Œå°±ä¸éœ€è¦ã€‚è¿™æ ·å°±å¯ä»¥å°†ä¸åŒåŠŸèƒ½çš„æœ€ç»ˆç”Ÿæˆä»£ç åŒºåˆ†å¼€ã€‚ ![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/925c2180d4e74840a3815313960ecb0c~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?)

åŠŸèƒ½å¼€å‘å®Œæ¯•ä¹‹åï¼Œå› ä¸ºå¤§éƒ¨åˆ†å…¬å¸éƒ½æ˜¯æœ‰è‡ªå·±çš„ç§æœ‰ npm åº“çš„ï¼Œæˆ‘è¿™é‡Œæ¼”ç¤ºä¸‹å‘å…¬å¼€åŒ…çš„æ­¥éª¤ï¼Œå…¶å®éƒ½å·®ä¸å¤šã€‚

### å‘å¸ƒ npm åŒ…

```bash
npm login
lerna publish
```

å‘åŒ…è¿™ä¸€æ­¥ï¼Œè¿˜æ˜¯æŒºå®¹æ˜“è¸©åˆ°å‘çš„ï¼Œè¿™é‡Œæ€»ç»“ä¸‹æˆ‘é‡åˆ°çš„ï¼š

1. **npm å…¬å¼€åŒ…çš„åç§°éœ€è¦æ˜¯å”¯ä¸€çš„ã€‚**

æœ€å¥½æå‰å» [npm](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2F "https://www.npmjs.com/") ç½‘ç«™æœç´¢ä¸€ä¸‹ï¼Œçœ‹è‡ªå·±å°†è¦å‘çš„åŒ…åæ˜¯å¦å·²å­˜åœ¨ã€‚æˆ–è€…èŠ±é’±ä¹°ç§æœ‰åŸŸï¼Œç±»ä¼¼äº @vue/xxx è¿™æ ·çš„ã€‚

2. **lerna publish é‡è¯•ä¸ç”Ÿæ•ˆã€‚**

è¿è¡Œ lerna publish å¦‚æœä¸­é€”æœ‰åŒ…å‘å¸ƒå¤±è´¥ï¼Œå†è¿è¡Œ lerna publish çš„æ—¶å€™ï¼Œå› ä¸º git çš„ Tag å·²ç»æ‰“ä¸Šå»äº†ï¼Œæ‰€ä»¥ä¸ä¼šå†é‡æ–°å‘å¸ƒåŒ…åˆ° NPMã€‚

è§£å†³æ–¹æ³•ï¼šè¿è¡Œ lerna publish from-gitï¼Œä¼šæŠŠå½“å‰æ ‡ç­¾ä¸­æ¶‰åŠçš„ NPM åŒ…å†å‘å¸ƒä¸€æ¬¡ï¼ŒPSï¼šä¸ä¼šå†æ›´æ–° package.jsonï¼Œåªæ˜¯æ‰§è¡Œ npm publish

3. **å…¨å±€ä¿®æ”¹ä¸ºæ·˜å® npm æºå¯¼è‡´çš„é—®é¢˜**

- æ·˜å®æºä¸å®˜æ–¹æºçš„åŒæ­¥å­˜åœ¨å»¶æ—¶

  ```
  npm åŒ…å·²ç»å‘å¸ƒæˆåŠŸï¼Œä½†å› ä¸ºå…¨å±€è®¾ç½®çš„æ˜¯æ·˜å®æºï¼Œäº²æµ‹ä¼šæœ‰ä¸€å®šçš„åŒæ­¥å»¶æ—¶ï¼Œå¤§æ¦‚åŠå°æ—¶åˆ°ä¸€ä¸ªå°æ—¶å·¦å³ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šæ›´æ–°ä¸åˆ°æœ€æ–°çš„åŒ…ç‰ˆæœ¬æˆ–è€…ç›´æ¥é¦–æ¬¡å‘ç‰ˆæˆåŠŸåçš„ä¸€æ®µæ—¶é—´å†…æ‰¾ä¸åˆ°åŒ…ã€‚
  ```

- å…¨å±€ç”¨æ·˜å®æºï¼Œä¼šå¯¼è‡´å‘åŒ…å¤±è´¥ã€‚

  ```
  å› ä¸ºæ·˜å®æºåªèƒ½ä¸‹è½½åŒ…ï¼Œä¸èƒ½ä¸Šä¼ åŒ…ã€‚ä½†æ˜¯ä¸ç”¨æ·˜å®æºï¼Œå®‰è£…å…¶ä»–ä¾èµ–åˆæ…¢çš„ä¸è¡Œã€‚ è§£å†³æ–¹æ³•ï¼š å®‰è£…ä¾èµ–ï¼Œç»Ÿä¸€ä»æ·˜å®æºæ‹‰ï¼Œä¿è¯ä¾èµ–å®‰è£…é€Ÿåº¦ã€‚å‘åŒ…æ—¶å€ŸåŠ© npm åŒ…çš„ package.json çš„`publishConfig`å­—æ®µæŒ‡å®šå®˜æ–¹æºï¼Œç¡®ä¿èƒ½å‘åŒ…æˆåŠŸã€‚
  ```

```jsx
"publishConfig": {
	"registry": "https://registry.npmjs.org/",
	"access": "public"
 },
```

4. **devDependencies** ä¸ **dependencies** çš„åŒºåˆ«

   é¦–å…ˆï¼Œåœ¨æ™®é€šçš„ä¸šåŠ¡é¡¹ç›®ä¸­ï¼Œè¿™ä¸¤è€…æ˜¯æ²¡æœ‰ä»»ä½•æœ¬è´¨åŒºåˆ«çš„ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨å®‰è£…æ—¶ï¼Œå¸¦ä¸å¸¦ --devï¼Œåªä¼šå½±å“æœ€ç»ˆåœ¨`package.json`ä¸­çš„å½’ç±»ä½ç½®ï¼Œæœ€ç»ˆä¼šä¸ä¼šè¢« webpack ç­‰çš„å·¥å…·æ‰“åŒ…æ„å»ºï¼Œåªå†³å®šäºæ˜¯å¦åœ¨é¡¹ç›®ä¸­è¢«å¼•ç”¨ã€‚

   ä½†å¯¹äºå‘åˆ° npm ä¸Šçš„é¡¹ç›®è€Œè¨€ï¼Œè¿™ç‚¹å¾ˆé‡è¦ã€‚ å½“ç”¨æˆ·å®‰è£…ä½ çš„åŒ…æ—¶ï¼Œ**åªæœ‰ç”Ÿäº§ä¾èµ–æ‰ä¼šè¢«ä¸€èµ·å®‰è£…**ï¼Œå¼€å‘ä¾èµ–åˆ™ä¸ä¼šã€‚å¦‚æœä½¿ç”¨ä¸å½“ï¼Œæ¯”å¦‚ä¸å°å¿ƒå°†ä¸€ä¸ªç”Ÿäº§ä¾èµ–è£…å…¥äº†å¼€å‘ä¾èµ–ï¼Œå®‰è£…ä½  npm åŒ…çš„ç”¨æˆ·ä¼šè¿è¡ŒæŠ¥é”™ï¼Œæ‰¾ä¸åˆ° xx æ¨¡å—ã€‚

## æœ€å

==

[npm åœ°å€](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Freact-booster-cli "https://www.npmjs.com/package/react-booster-cli")ã€ [github åœ°å€](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFEyudong%2Fbooster%2Ftree%2Fmaster%2Fpackages%2Freact-booster-cli "https://github.com/FEyudong/booster/tree/master/packages/react-booster-cli"), æ¬¢è¿å¤§å®¶è¯•ç”¨ï¼Œ æ`issues`ã€‚è¿™ä¸ªé¡¹ç›®æ˜¯æˆ‘ä¸šä½™æ—¶é—´å¼€å‘çš„ï¼Œ**ä»¥ä¸Šæ ‡é¢˜åŠæ•…äº‹æƒ…èŠ‚ä¹Ÿçº¯å±è™šæ„**ã€‚ä»£ç æ˜¯å®Œå…¨è„±æ•å…¬å¼€çš„ï¼Œå¦‚æœä½ ä»¬å›¢é˜Ÿä¹Ÿæœ‰ç±»ä¼¼çš„éœ€æ±‚ï¼Œå¯ä»¥ç»™å¤§å®¶æä¾›ä¸€ä¸ªå‚è€ƒï¼Œè¿™å°±æ˜¯æˆ‘æœ€å¥½çš„æ”¶è·ã€‚
