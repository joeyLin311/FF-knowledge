---
date created: 2022-07-01 12:46
---

## DNS 概念

DNS 即域名系统( Domain Name Sysytem). 当 URL 输入之后, 浏览器会向该 URL 的主机名对应的服务器发送请求, 获知服务器 IP 地址. 对于浏览器来说 DNS 的作用就是通过 URL 查找到对应的 IP 地址.

以下摘抄 DNS 概念:

> DNS 是
>
> 1. 一个由分层的 DNS 服务器实现的分布式数据库
> 2. 一个使得主机能够查询分布式数据库的应用层协议

由此可得:

- DNS 是一个应用层协议, 每当发送一个请求, 其中就包含需要查询的主机名, DNS 会返回给客户端主机名对应的 IP
- DNS 是一个分布式数据库, 整个 DNS 系统由分散在世界各地的多台 DNS 服务器组成, 每台 DNS 都保存一定的数据, 这些数据可以查到主机名对应的 IP
- DNS 的查询过程简单来讲就是去这些不同的 DNS 服务器询问是否有当前主机名对应的 IP 地址, 通过不同层次的 DNS 服务器递归和迭代查询到最终所需要的 IP 地址

## DNS 服务器层次

- 根 DNS 服务器

例如 `www.abc.com.` 最后一个 `.` 就是根域名.  根域名可以通过询问根 DNS 服务器获得顶级域 DNS 服务器 IP, 从而继续从顶级域 DNS 继续发送查询请求

- 顶级域 DNS 服务器
从不同的根 DNS 服务器的下一级就是顶级域 DNS 服务器, 也就是 TLD . 它是 URL 最后一串域名如 `.com` 的 DNS 服务器
- 权威 DNS 服务器
TLD DNS 服务器的下一级是权威 DNS 服务器. 权威 DNS 服务器可以返回 主机-IP 的最终映射.
## 关于本地 DNS 服务器

在 DNS 层次结构中,  本地 DNS 服务器并不属于 DNS 的层次结构. 但是每个 ISP 都有一台本地 DNS 服务器, 这种本地 DNS 服务是起着代理的作用, 负责将查询请求转发到 DNS 服务器的层次结构中.

## 递归查询, 迭代查询
先说明 DNS 查询的流程, 以 `m.n.com` 到 `a.b.com` 的 IP 地址的过程:

1. 首先 `m.n.com` 会向本地 DNS 服务器发送 DNS 查询报文, 其中包含期待的 `a.b.com` 的主机名
2. 本地 DNS 服务器将该报文转发到 根 DNS 服务器
3. 根 DNS 服务器查询到该URL中包含 `.com` 后缀, 所以向本地 DNS 服务器返回 `.com` 对应的顶级域 DNS 服务器(TLD)的 IP 地址列表
4. 本地 DNS 服务器向其中一台 TLD 服务器发送查询报文
5. 该 TLD 服务器注意到 `b.com`, 便向本地 DNS 服务器返回权威 DNS 服务器的 IP 地址. 
6. 本地 DNS 服务器再次向其中一台权威 DNS 服务器发送查询报文
7. 权威 DNS 服务器会返回最终 `a.b.com` 对应的 IP 地址
8. 本地 DNS 服务器接收到 `a.b.com` 和 IP 的映射关系后返回给主机 `m.n.com` , 那么 `m.n.com` 就可以用这个 IP 向 `a.b.com` 发送请求
其中, 主机`m.n.com` 向本地 DNS 服务器查询是递归查询, 该查询动作是 `m.n.com` 以自身名义向 DNS 服务器请求相关的 IP 映射, 本地DNS 服务器直接返回映射结果给主机.

后继的三个 DNS 层级查询是迭代查询, 包括**本地 DNS 服务器向根DNS 服务器发送查询请求**, **本地 DNS 服务器向 TLD 服务器发送查询请求**, **本地 DNS 服务器向权威 DNS 服务器发送查询请**求. 上述请求都是由本地 DNS 服务器发出, 请求返回的目标都是 DNS 服务器.

理论上来说任何 DNS 查询既可以是递归的, 也可以是迭代的. 包括如果在递归中 TLD 服务器并不知道权威 DNS 服务器的地址, 就会迭代更多 DNS 查询.