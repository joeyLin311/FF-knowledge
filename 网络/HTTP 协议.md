---
date created: 2021-12-09 22:56
date updated: 2021-12-17 16:09
---

#Network

## 综述

- HTTP 协议构建于 TCP/IP 协议之上, 属于 # OSI模型 中的应用层协议, 默认端口80
- HTTP 是**无连接无状态**的
- 无连接: 每次请求都需要连接一次, 请求结束立即断开, 不会保持连接
- 无状态: 每次请求都是独立的, 请求结束不会记录连接的任何信息

## HTTP 1.0/1.1/2.0 版本区别

### HTTP1.0

1. 与服务器只保持短暂链接, 每次请求都需要与服务器简历一个 TCP 连接, 请求完毕后立即断开, 连接无法复用
2. 不会追踪 IP
3. Head-of-line blocking(HOLB) 对头阻塞会导致带宽无法被充分利用, 以致于健康的请求被不健康的请求影响
4. **解决方案:** 在请求头添加 `Connection: keep-alive`

#### 浏览器链接限制 6个

### HTTP1.1

1. **持久链接**, TCP 默认不关闭, 可以被多个请求复用, 默认链接为 `connection: keep-alive` 不用显式声明, **允许同个域名同时建立 6 个持久连接** [[HTTP keep-alive 和 TCP keepAlive]]
2. **缓存处理**, HTTP1.1 引入了更多的缓存策略, 例如 Entity tag, If-Unmodified-Since, If-Match, If-None-Match等更多可供选择的缓存头来控制缓存策略
3. **带宽优化及网络连接的使用**, 支持断点续传, 请求头引入 range 头域允许只请求资源的某个部分(code = 206)
4. **错误通知管理**, HTTP1.1 增加了 24 个错误状态响应码, 409, 410 etc.
5. [[HTTP 请求方式]]
6. [[HTTP 状态码]]

### HTTP2.0

1. 完全兼容 1.x 协议, 大幅提升性能
2. **二进制分帧(Binary Format)**, HTTP2.0 在应用层和 TCP 传输层增加了一个二进制分帧层,把传输信息分割成更小的消息和帧,对其采用二进制编码, 改进了传输性能, 实现低延迟和高吞吐量
3. 实现请求优先级
4. **多路复用(Multiplexing)**, HTTP1.x 在浏览器中同一时间同一个域名下的请求有一定的数量限制, 超过限制会造成阻塞. **这也是启用 CDN 的原因之一.** HTTP2.0 的多路复用优化了这一情况, 允许同时通过单一的HTTP 连接发起多重请求, 因为有分帧机制, 也不用依赖多个 TCP.实现更优的带宽管理
5. **头部压缩**, HTTP2.0 使用HPACK来减少请求 header 的大小
6. **服务端推送**, 服务器可以对一个客户端请求发送多个响应, 服务器向客户端推送无需客户端明确地请求, 还能把资源跟 index.html 一起发送到客户端. 而且还能缓存资源, 实现不同页面共享缓存资源

### HTTP3
**队头阻塞问题**
- HTTP1.1 通过持久连接解决了 TCP 连接频繁的创建销毁, HTTP2.0又通过废弃管道化, 引入分帧, 多路复用, 请求优先级等概念, 客户端和服务器可以将HTTP消息分解成互不依赖的帧, 进行乱序发送, 解决了 HTTP请求里一定程度的队头阻塞问题.
- 但是HTTP2 仍旧会存在队头阻塞问题, 因为 HTTP2 还是依赖 TCP 协议实现的. 在TCP传输过程中会把数据拆分成一个个按照顺序排列的包, 客户端会按照顺序重新组合成原始数据. 但是如果在过程中某个数据包没有按照顺讯达到, 客户端会一直保持连接等待数据包返回, 这样就造成后续请求阻塞. 
- HTTP2.0 中的多路复用技术是基于同一个 TCP 连接进行的, 这样受到TCP连接阻塞的影响会更大. 
- TCP 是一种可靠的通信协议, 通过三次握手保证连接双方数据传输的稳定. 但是三次握手是需要时间的. 
- 这个时间概念称为**网络延迟 RTT**(Round Trip Time) : 它指的是一个请求从客户端发送一个请求数据包到服务器, 再从服务器得到响应包的这段时间, RTT 是反应网络性能的一个重要指标. **TCP 的三次握手, 消耗了 1.5RTT 而如果引入了 HTTPS 的完整的 HTTP2.0 链接则需要消耗 3-4RTT**

可见 HTTP协议从1.0到2.0, 都依赖于TCP 协议的实现, 如果要解决网络延迟的问题, 需要在传输层使用另外的传输协议, 而HTTP3 就是使用了由UDP 改造而来的 QUIC 协议. 解决网络延迟, 队头阻塞[[HTTP3 协议]]


<https://juejin.cn/post/6994629873985650696>

<https://juejin.cn/post/6844904100035821575#heading-14>
