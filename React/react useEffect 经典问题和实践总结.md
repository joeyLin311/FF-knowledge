> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [juejin.cn](https://juejin.cn/post/7077757011013664776)

ä¸€ã€èƒŒæ™¯
----

æ¥è§¦`Hooks`5 ä¸ªæœˆï¼Œä»ä¹‹å‰çš„æ¯«æ— åŸºç¡€ã€ç…§ç€è€ä»£ç ä¸€æ­¥ä¸€æ­¥æ¨¡ä»¿ï¼Œç°åœ¨å·²ç»èƒ½åº”ä»˜å¤§éƒ¨åˆ†å·¥ä½œä¸­çš„é—®é¢˜ã€‚è¿™æœŸé—´é‡åˆ°è¿‡å¾ˆå¤šé—®é¢˜ï¼Œè™½ç„¶ç”¨è¿™æ ·é‚£æ ·çš„æ‰‹æ®µæ»¡è¶³äº†éœ€æ±‚ï¼Œä½†æ˜¯æ€»ä¸èƒ½ç†è§£è¿™äº›æ‰‹æ®µèƒŒåçš„åŸç†ï¼Œä¸ºæ­¤ä¹Ÿæ‰¾äº†å¾ˆå¤šæ•™ç¨‹æ¥çœ‹ï¼Œç”±äºè¿™äº›æ•™ç¨‹éƒ½èšç„¦åœ¨å¦‚ä½•ä½¿ç”¨ï¼Œå¯¹äºèƒŒåçš„å¿ƒæ™ºæ¨¡å‹æ²¡æœ‰åšæ›´å¤šçš„è§£è¯»ï¼Œç›´åˆ°è¯»äº† Dan çš„ã€ŠuseEffect å®Œæ•´æŒ‡å—ã€‹ï¼Œæ‰æœ‰äº†â€ å“¦ğŸ˜¯ï¼ŒåŸæ¥å¦‚æ­¤çš„æ„Ÿè§‰ â€œã€‚

æ¥ä¸‹æ¥æˆ‘å°†ä»`useEffect`äº”ä¸ªç»å…¸é—®é¢˜åŠè‡ªå·±å®è·µä¸¤ä¸ªç»´åº¦æ¥é˜è¿°æˆ‘çš„ç†è§£ã€‚

äºŒã€`useEffect`äº”ä¸ªç»å…¸é—®é¢˜
-------------------

## 1. ğŸ¤” å¦‚ä½•ç”¨`useEffect`æ¨¡æ‹Ÿ`componentDidMount`ç”Ÿå‘½å‘¨æœŸï¼Ÿ

å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå¤§å®¶ä¼šä¹ æƒ¯æ€§çš„æƒ³åˆ°`useEffect(()=>{fetchData()}),[])`, å°†ä¾èµ–é¡¹æ•°ç»„ç½®ä¸ºç©ºå³å¯ï¼Œè¿™æ˜¯ä¸€ä¸ªç®¡ç”¨çš„æ–¹æ³•ï¼Œå¯æ˜¯è¿™ä¸ªé—®é¢˜æ˜¯ä¸ªé™·é˜±ã€‚å‡½æ•°ç»„ä»¶å’Œ`class`ç»„ä»¶çš„å¿ƒæ™ºæ¨¡å‹æ˜¯ä¸ä¸€æ ·çš„ï¼Œä¸èƒ½æŠŠä»–ä»¬æ··ä¸ºä¸€è°ˆï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œä»–ä»¬æœ€å¤§çš„åŒºåˆ«æ˜¯å½“çŠ¶æ€å˜åŒ–æ—¶ï¼Œå‡½æ•°ç»„ä»¶ç›¸å½“äºç»å†äº†è½®å›ï¼Œä»ç§å­é•¿æˆèŠ±æœµï¼Œå†ä»èŠ±æœµç»“æˆç§å­ï¼Œä¸åŒå¹´ä»½çš„èŠ±æœµçœ‹èµ·æ¥ä¸€æ ·ï¼Œä½†ç»ˆç©¶ä¸æ˜¯åŒä¸€æœµï¼Œè€Œ`class`ç»„ä»¶ç›¸å½“äºä¸€æœµèŠ±ï¼Œä»é²œè‰³çš„èŠ±æœµå˜æˆå¹²èŠ±æŸï¼Œå½¢æ€ä¸åŒï¼Œä½†å§‹ç»ˆæ˜¯é‚£ä¸€æœµã€‚

## 2. ğŸ¤” å¦‚ä½•æ­£ç¡®åœ°åœ¨`useEffect`é‡Œè¯·æ±‚æ•°æ®ï¼Ÿ`[]`åˆæ˜¯ä»€ä¹ˆï¼Ÿ

æ¯ä¸ª`useEffect`éƒ½æ˜¯ä¸åŒçš„ï¼Œéšç€çŠ¶æ€çš„å˜åŒ–ï¼Œä¸€ä¸ªä¸ª`effect`å‡ºç”Ÿï¼Œä¸€ä¸ªä¸ª`effect`æ­»å»ï¼Œæ€ä¹ˆä¿è¯å‡ºç”Ÿçš„`effect`æ˜¯æˆ‘ä»¬æƒ³è¦çš„å‘¢ï¼Œè¿™å°±éœ€è¦å€ŸåŠ©ä¾èµ–æ•°ç»„æ¥æ³¨å…¥é—ä¼ å› å­ï¼Œè¯·æ±‚è¿‡ç¨‹ä¸­ç”¨åˆ°çš„æ‰€æœ‰çš„é—ä¼ å› å­éƒ½è¦å†™åˆ°æ•°ç»„é‡Œï¼Œå½“ç„¶è¿™æ˜¯æœ€ä¿é™©çš„æ–¹æ³•ï¼Œå¦‚æœæƒ³æ›´ä¼˜é›…ä¸€äº›ï¼Œå¯ä»¥çœ‹å¼•ç”¨æ–‡çŒ®åŠä¸‹é¢çš„å®è·µæ€»ç»“ã€‚

## 3. ğŸ¤” æˆ‘åº”è¯¥æŠŠå‡½æ•°å½“åš`effect`çš„ä¾èµ–å—ï¼Ÿ

å¯ä»¥æŠŠå‡½æ•°ä½œä¸º`effect`çš„ä¾èµ–ã€‚æ›´å¤šå…³äºå‡½æ•°çš„æœ€ä½³å®è·µçœ‹ä¸‹é¢çš„å®è·µæ€»ç»“ã€‚

## 4. ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ä¼šå‡ºç°æ— é™é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿ

åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯æ²¡æœ‰ä¾èµ–æ•°ç»„ï¼Œé‚£ä¹ˆæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè§¦å‘è¿™ä¸ªå‰¯ä½œç”¨ï¼Œä¾‹å¦‚

```js
useEffect(()=>{
    fetchData()
})
```

è¿˜æœ‰ä¸€ç§æ˜¯è®¾ç½®äº†ä¾èµ–æ•°ç»„ï¼Œä½†æ˜¯ä¾èµ–æ•°ç»„é‡Œçš„å˜é‡ä¸€ç›´åœ¨å˜ï¼Œä¾‹å¦‚

```js
const [data,setData] = useState()

useEffect(()=>{
    const fetchData = async() => {
        const res = await fetchNewData()
        setData(res.data)
    }
    fetchData()
},[data])
```

## 5. ğŸ¤” ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åœ¨`effect`é‡Œæ‹¿åˆ°çš„æ˜¯æ—§çš„`state`æˆ–`prop`ï¼Ÿ

`effect`é‡Œè·å–çš„å§‹ç»ˆåº”è¯¥æ˜¯æœ€æ–°çš„`state`æˆ–`prop`ï¼Œå¦‚æœå‡ºç°æ—§çš„`state`æˆ–`prop`ï¼Œä¸€å®šæ˜¯å› ä¸ºä¾èµ–æ•°ç»„ä¸­çš„ä¾èµ–é¡¹ä¸å®Œæ•´ï¼Œæ²¡èƒ½è§¦å‘`effect`æ›´æ–°ã€‚

ä¸‰ã€`useEffect`æœ€ä½³å®è·µæ€»ç»“
-------------------

## 1.`class`ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„åŒºåˆ«

* æ¯ä¸€ä¸ªå‡½æ•°ã€æ¯ä¸€ä¸ª`useEffect`ä¸­çš„`props`å’Œ`state`éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚ä¸æ˜¯`state`åœ¨ä¸å˜çš„`effect`ä¸­å˜åŒ–ï¼Œè€Œæ˜¯æ¯ä¸€ä¸ª`effect`ä¸­æœ‰ä¸å˜çš„`state`
* å‡½æ•°ç»„ä»¶çš„çŠ¶æ€ä¼šåœç•™åœ¨æŸä¸ªçŠ¶æ€ï¼Œæ”¹å˜åçš„çŠ¶æ€è·Ÿå‰è€…ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥ä¸åŒæ—¶æœºä¸åŒçŠ¶æ€ï¼›`class`ç»„ä»¶ä¸­ï¼ŒçŠ¶æ€å§‹ç»ˆæŒ‡å‘`this.state`ï¼Œä¸åŒæ—¶æœºä½†æ˜¯åŒä¸€ä¸ªçŠ¶æ€
* `useEffect`å¹¶ä¸ç­‰äº`componentDidmount` + `componentDieUpdate`ï¼Œå°†å‡½æ•°ä¼ å…¥åˆ°å­ç»„ä»¶ï¼Œå¦‚ä½•ä»…åœ¨éœ€è¦çš„æ—¶å€™è§¦å‘è¿™ä¸ªè¯·æ±‚ï¼Œæ˜¯åˆ†è¾¨ä¸¤è€…çš„æœ€ä½³åŠæ³•ï¼Œå‡½æ•°å¼ç»„ä»¶ä¼ å…¥çš„å‡½æ•°æ˜¯ç±»çš„ä¸€ä¸ªå±æ€§ï¼Œæ˜¯æ°¸è¿œä¸ä¼šå˜çš„ï¼Œä»–æ°¸è¿œåªä¼šè¯·æ±‚ä¸€æ¬¡æ•°æ®ï¼Œå¦‚æœä¼ å…¥å®ƒçš„ä¾èµ–å‚æ•°ï¼Œä¾èµ–å‚æ•°é»˜è®¤æ˜¯ä¸€ç›´å˜åŠ¨çš„ï¼Œæ‰€ä»¥å°±ä¼šä¸€ç›´é‡æ–°è¯·æ±‚æ•°æ®ã€‚å¦‚æœç”¨`hooks`ä¼ é€’ï¼Œè®¾ç½®å¥½é€‚å½“çš„ä¾èµ–é¡¹ï¼Œå°±åªä¼šåœ¨ä¾èµ–é¡¹å˜åŠ¨çš„æ—¶å€™é‡æ–°è¯·æ±‚æ•°æ®
* `useEffect`å…ˆæ¸²æŸ“ï¼Œåæ‰§è¡Œ`preState`å’Œ`curState`çš„å‰¯ä½œç”¨

## 2. å¦‚ä½•å®šä¹‰å‡½æ•°å’Œè¯·æ±‚

* æŸäº›å‡½æ•°åªåœ¨`effect`ä¸­ä½¿ç”¨çš„è¯ï¼Œé‚£å°±åœ¨`effect`é‡Œå®šä¹‰
* æŸäº›å‡½æ•°åœ¨å¤šä¸ªåœ°æ–¹ç”¨åˆ°ï¼Œå°±ç‹¬ç«‹å®šä¹‰ï¼Œæœ€å¥½ç”¨`useCallBack`åŒ…è£¹ï¼Œå¹¶ä¸”åœ¨ä¾èµ–æ•°ç»„é‡ŒæŠŠä¾èµ–é¡¹å†™å…¨
* `useEffect`å›è°ƒå‡½æ•°ä¸èƒ½ç”¨`async`ä¿®é¥°ï¼Œä½†æ˜¯å¯ä»¥åœ¨å›è°ƒå‡½æ•°å†…éƒ¨é‡æ–°å†™ä¸€ä¸ª`async`å‡½æ•°ï¼Œç„¶åè°ƒç”¨

```jsx
//ä¸å¯ä»¥
useEffect(async()=>{
    const res = await fetchNewData(id)
    setData(res.data)
},[id])


//æ¨è
useEffect(()=>{
const fetchData = async() => {
    const res = await fetchNewData(id)
    setData(res.data)
}
fetchData()
},[id])
```

å››ã€å‚è€ƒæ–‡çŒ®
------

1. [useEffect å®Œæ•´æŒ‡å—](https://link.juejin.cn?target=https%3A%2F%2Foverreacted.io%2Fzh-hans%2Fa-complete-guide-to-useeffect%2F%23tldr "https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/#tldr")
2. [[è¯‘] å¦‚ä½•ç”¨ React Hooks è·å–æ•°æ®](https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F104946710 "https://zhuanlan.zhihu.com/p/104946710")
